<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finance Tracker</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body style="margin:0;padding:0;background:#0f172a;color:white;min-height:100vh;">
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Storage API using localStorage
    const storage = {
      get: async (key) => {
        const value = localStorage.getItem(key);
        return value ? { key, value, shared: false } : null;
      },
      set: async (key, value) => {
        localStorage.setItem(key, value);
        return { key, value, shared: false };
      },
      delete: async (key) => {
        localStorage.removeItem(key);
        return { key, deleted: true, shared: false };
      }
    };
    
    // Icon Components
    const PlusCircle = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/>
      </svg>
    );
    
    const Plus = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
    );
    
    const TrendingUp = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>
      </svg>
    );
    
    const TrendingDown = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/>
      </svg>
    );
    
    const DollarSign = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
      </svg>
    );
    
    const Calendar = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
    );
    
    const Trash2 = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/>
      </svg>
    );
    
    const Edit2 = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
      </svg>
    );
    
    const ChevronDown = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="6 9 12 15 18 9"/>
      </svg>
    );
    
    const ChevronUp = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="18 15 12 9 6 15"/>
      </svg>
    );
    
    const Download = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
      </svg>
    );
    
    const Upload = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
      </svg>
    );
    
    // Helper Functions
    const formatCurrency = (amount) => {
      return amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    };
    
    const getESTDateString = () => {
      const date = new Date();
      const estDate = new Date(date.toLocaleString('en-US', { timeZone: 'America/New_York' }));
      return estDate.toISOString().split('T')[0];
    };
    
    const getFinancialMonth = (dateStr) => {
      const date = new Date(dateStr);
      const day = date.getDate();
      let month = date.getMonth();
      let year = date.getFullYear();
      
      if (day < 28) {
        month = month - 1;
        if (month < 0) {
          month = 11;
          year = year - 1;
        }
      }
      
      return { financialMonth: month, financialYear: year };
    };
    
    // Main App Component
    const FinanceTracker = () => {
      // State - All start EMPTY
      const [transactions, setTransactions] = useState([]);
      const [recurringPayments, setRecurringPayments] = useState([]);
      const [debts, setDebts] = useState([]);
      const [paidRecurring, setPaidRecurring] = useState({});
      const [customExpenseCategories, setCustomExpenseCategories] = useState([]);
      const [customIncomeCategories, setCustomIncomeCategories] = useState([]);
      
      // UI State
      const [activeTab, setActiveTab] = useState('dashboard'); // NEW: Tab navigation (Phase 1: testing)
      const [isRecurringExpanded, setIsRecurringExpanded] = useState(false);
      const [isDebtTrackerExpanded, setIsDebtTrackerExpanded] = useState(false);
      const [isYearlyAnalysisExpanded, setIsYearlyAnalysisExpanded] = useState(false);
      const [isCustomCategoriesExpanded, setIsCustomCategoriesExpanded] = useState(false);
      const [isAddTransactionExpanded, setIsAddTransactionExpanded] = useState(false); // Changed to collapsed
      const [expandedMonths, setExpandedMonths] = useState({});
      const [expandedCategories, setExpandedCategories] = useState({}); // For yearly analysis
      
      // Form State
      const [description, setDescription] = useState('');
      const [amount, setAmount] = useState('');
      const [category, setCategory] = useState('');
      const [customCategory, setCustomCategory] = useState('');
      const [showCustomCategory, setShowCustomCategory] = useState(false);
      const [type, setType] = useState('expense');
      const [date, setDate] = useState(getESTDateString());
      const [editingId, setEditingId] = useState(null);
      
      // Add forms state
      const [showAddRecurring, setShowAddRecurring] = useState(false);
      const [showAddDebt, setShowAddDebt] = useState(false);
      const [newRecurring, setNewRecurring] = useState({
        name: '', amount: '', category: 'Subscriptions', day: 1, auto: true, varies: false
      });
      const [newDebt, setNewDebt] = useState({
        name: '', balance: '', apr: '', payment: '', dueDay: 1
      });
      
      // Default Categories (NOT hardcoded payments/debts)
      const defaultExpenseCategories = [
        'Food', 'Subscriptions', 'Groceries', 'Home', 'Car Payments', 
        'Personal', 'Pets', 'Utilities', 'Gas (cars)', 'Debt', 
        'Other', 'Insurance', 'Kids', 'Savings', 'House cleaning'
      ];
      const defaultIncomeCategories = ['Salary', 'Freelance', 'Investment', 'Gift', 'Bonus', 'Other'];
      
      const expenseCategories = [...defaultExpenseCategories, ...customExpenseCategories].sort();
      const incomeCategories = [...defaultIncomeCategories, ...customIncomeCategories].sort();
      
      // Load data on mount
      useEffect(() => {
        loadData();
      }, []);
      
      const loadData = async () => {
        try {
          const txResult = await storage.get('finance-transactions');
          if (txResult?.value) setTransactions(JSON.parse(txResult.value));
          
          const recurringResult = await storage.get('recurring-payments');
          if (recurringResult?.value) setRecurringPayments(JSON.parse(recurringResult.value));
          
          const debtsResult = await storage.get('debts');
          if (debtsResult?.value) setDebts(JSON.parse(debtsResult.value));
          
          const paidResult = await storage.get('paid-recurring');
          if (paidResult?.value) setPaidRecurring(JSON.parse(paidResult.value));
          
          const customExpResult = await storage.get('custom-expense-categories');
          if (customExpResult?.value) setCustomExpenseCategories(JSON.parse(customExpResult.value));
          
          const customIncResult = await storage.get('custom-income-categories');
          if (customIncResult?.value) setCustomIncomeCategories(JSON.parse(customIncResult.value));
        } catch (error) {
          console.log('Starting fresh - no saved data found');
        }
      };
      
      const saveData = async (data) => {
        await storage.set('finance-transactions', JSON.stringify(data));
      };
      
      const saveRecurringPayments = async (data) => {
        await storage.set('recurring-payments', JSON.stringify(data));
      };
      
      const saveDebts = async (data) => {
        await storage.set('debts', JSON.stringify(data));
      };
      
      const savePaidRecurring = async (data) => {
        await storage.set('paid-recurring', JSON.stringify(data));
      };
      
      const saveCustomCategories = async (exp, inc) => {
        await storage.set('custom-expense-categories', JSON.stringify(exp));
        await storage.set('custom-income-categories', JSON.stringify(inc));
      };
      
      // Add Transaction
      const addTransaction = () => {
        const finalCategory = showCustomCategory ? customCategory : category;
        
        if (!description || !amount || !finalCategory) {
          alert('Please fill in all fields');
          return;
        }
        
        // Save custom category if used
        if (showCustomCategory && customCategory) {
          const isExpense = type === 'expense';
          const updated = isExpense ? [...customExpenseCategories, customCategory] : [...customIncomeCategories, customCategory];
          if (isExpense) {
            setCustomExpenseCategories(updated);
            saveCustomCategories(updated, customIncomeCategories);
          } else {
            setCustomIncomeCategories(updated);
            saveCustomCategories(customExpenseCategories, updated);
          }
        }
        
        const newTransaction = {
          id: editingId || Date.now(),
          description,
          amount: parseFloat(amount),
          category: finalCategory,
          type,
          date,
          ...getFinancialMonth(date)
        };
        
        let updatedTransactions;
        if (editingId) {
          updatedTransactions = transactions.map(t => t.id === editingId ? newTransaction : t);
          setEditingId(null);
        } else {
          updatedTransactions = [...transactions, newTransaction];
          
          // Apply to debt if expense and matches debt name
          if (type === 'expense') {
            applyPaymentToDebt(description, parseFloat(amount), date, finalCategory);
          }
        }
        
        setTransactions(updatedTransactions);
        saveData(updatedTransactions);
        resetForm();
      };
      
      const resetForm = () => {
        setDescription('');
        setAmount('');
        setCategory('');
        setCustomCategory('');
        setShowCustomCategory(false);
        setType('expense');
        setDate(getESTDateString());
      };
      
      const deleteTransaction = (id) => {
        const updated = transactions.filter(t => t.id !== id);
        setTransactions(updated);
        saveData(updated);
      };
      
      const editTransaction = (transaction) => {
        setDescription(transaction.description);
        setAmount(transaction.amount.toString());
        setCategory(transaction.category);
        setType(transaction.type);
        setDate(transaction.date);
        setEditingId(transaction.id);
        setIsAddTransactionExpanded(true);
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };
      
      // Recurring Payments
      const addRecurringPayment = () => {
        if (!newRecurring.name || !newRecurring.amount) {
          alert('Please fill in name and amount');
          return;
        }
        
        const payment = {
          id: Date.now(),
          name: newRecurring.name,
          amount: parseFloat(newRecurring.amount),
          category: newRecurring.category,
          day: parseInt(newRecurring.day),
          auto: newRecurring.auto,
          varies: newRecurring.varies
        };
        
        const updated = [...recurringPayments, payment];
        setRecurringPayments(updated);
        saveRecurringPayments(updated);
        setNewRecurring({ name: '', amount: '', category: 'Subscriptions', day: 1, auto: true, varies: false });
        setShowAddRecurring(false);
      };
      
      const deleteRecurringPayment = (id) => {
        if (confirm('Delete this recurring payment?')) {
          const updated = recurringPayments.filter(p => p.id !== id);
          setRecurringPayments(updated);
          saveRecurringPayments(updated);
        }
      };
      
      const markRecurringAsPaid = (payment, customAmount = null) => {
        const today = new Date();
        const monthKey = `${today.getFullYear()}-${today.getMonth()}`;
        const paymentKey = `${monthKey}-${payment.id}`;
        const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(payment.day).padStart(2, '0')}`;
        const paymentAmount = customAmount || payment.amount;
        
        const newTransaction = {
          id: Date.now(),
          description: payment.name,
          amount: paymentAmount,
          category: payment.category,
          type: 'expense',
          date: dateStr,
          ...getFinancialMonth(dateStr)
        };
        
        const updatedTransactions = [...transactions, newTransaction];
        setTransactions(updatedTransactions);
        saveData(updatedTransactions);
        
        const updatedPaid = { ...paidRecurring, [paymentKey]: true };
        setPaidRecurring(updatedPaid);
        savePaidRecurring(updatedPaid);
        
        applyPaymentToDebt(payment.name, paymentAmount, dateStr, payment.category);
      };
      
      const isRecurringPaidThisMonth = (paymentId) => {
        const today = new Date();
        const monthKey = `${today.getFullYear()}-${today.getMonth()}`;
        const paymentKey = `${monthKey}-${paymentId}`;
        return paidRecurring[paymentKey] || false;
      };
      
      // Debts
      const addDebt = () => {
        if (!newDebt.name || !newDebt.balance || !newDebt.apr || !newDebt.payment) {
          alert('Please fill in all fields');
          return;
        }
        
        const debt = {
          id: Date.now(),
          name: newDebt.name,
          balance: parseFloat(newDebt.balance),
          originalBalance: parseFloat(newDebt.balance),
          apr: parseFloat(newDebt.apr),
          payment: parseFloat(newDebt.payment),
          dueDay: parseInt(newDebt.dueDay),
          lastUpdated: getESTDateString(),
          recurringPaymentId: null
        };
        
        const updated = [...debts, debt];
        setDebts(updated);
        saveDebts(updated);
        setNewDebt({ name: '', balance: '', apr: '', payment: '', dueDay: 1 });
        setShowAddDebt(false);
      };
      
      const deleteDebt = (id) => {
        if (confirm('Delete this debt?')) {
          const updated = debts.filter(d => d.id !== id);
          setDebts(updated);
          saveDebts(updated);
        }
      };
      
      const applyPaymentToDebt = (paymentName, paymentAmount, paymentDate, paymentCategory) => {
        const normalizeForMatch = (name) => {
          let normalized = name.toLowerCase().replace(/[^a-z0-9]/g, '');
          if (normalized === 'szc' || normalized === 'szccar') normalized = 'szccar';
          if (normalized === 'cic' || normalized === 'ciccar') normalized = 'ciccar';
          return normalized;
        };
        
        const normalizedPayment = normalizeForMatch(paymentName);
        const matchingDebt = debts.find(d => {
          const nameMatches = normalizeForMatch(d.name) === normalizedPayment;
          const categoryIsDebtRelated = ['debt', 'car payments', 'home', 'personal'].includes(paymentCategory.toLowerCase());
          return nameMatches && categoryIsDebtRelated;
        });
        
        if (matchingDebt) {
          const updatedDebts = debts.map(d => {
            if (d.id === matchingDebt.id) {
              return {
                ...d,
                balance: d.balance - paymentAmount,
                lastUpdated: paymentDate
              };
            }
            return d;
          });
          setDebts(updatedDebts);
          saveDebts(updatedDebts);
        }
      };
      
      // Export/Import
      const exportData = () => {
        const today = new Date();
        const dateStr = today.toISOString().split('T')[0];
        
        const exportObject = {
          version: '2.0',
          exportDate: today.toISOString(),
          transactions,
          debts,
          recurringPayments,
          paidRecurring,
          customExpenseCategories,
          customIncomeCategories
        };
        
        const dataStr = JSON.stringify(exportObject, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `finance-data-${dateStr}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };
      
      const importData = (event) => {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            
            if (data.version === '2.0') {
              if (data.transactions) {
                // Convert old format (month/year) to new format (financialMonth/financialYear)
                const convertedTransactions = data.transactions.map(t => {
                  if (t.month !== undefined && t.financialMonth === undefined) {
                    return {
                      ...t,
                      financialMonth: t.month,
                      financialYear: t.year
                    };
                  }
                  return t;
                });
                setTransactions(convertedTransactions);
                saveData(convertedTransactions);
              }
              if (data.debts) {
                setDebts(data.debts);
                saveDebts(data.debts);
              }
              if (data.recurringPayments) {
                setRecurringPayments(data.recurringPayments);
                saveRecurringPayments(data.recurringPayments);
              }
              if (data.paidRecurring) {
                setPaidRecurring(data.paidRecurring);
                savePaidRecurring(data.paidRecurring);
              }
              if (data.customExpenseCategories) {
                setCustomExpenseCategories(data.customExpenseCategories);
              }
              if (data.customIncomeCategories) {
                setCustomIncomeCategories(data.customIncomeCategories);
              }
              if (data.customExpenseCategories || data.customIncomeCategories) {
                saveCustomCategories(data.customExpenseCategories || [], data.customIncomeCategories || []);
              }
              alert('Data imported successfully!');
            } else if (Array.isArray(data)) {
              // Old format - just transactions array
              const convertedTransactions = data.map(t => {
                if (t.month !== undefined && t.financialMonth === undefined) {
                  return {
                    ...t,
                    financialMonth: t.month,
                    financialYear: t.year
                  };
                }
                return t;
              });
              setTransactions(convertedTransactions);
              saveData(convertedTransactions);
              alert('Transactions imported successfully!');
            } else {
              alert('Unrecognized file format');
            }
          } catch (error) {
            alert('Error importing file: ' + error.message);
          }
        };
        reader.readAsText(file);
      };
      
      const clearAllData = () => {
        const confirmation = prompt('Type "yes" to clear all data:');
        if (confirmation?.toLowerCase() === 'yes') {
          setTransactions([]);
          setRecurringPayments([]);
          setDebts([]);
          setPaidRecurring({});
          setCustomExpenseCategories([]);
          setCustomIncomeCategories([]);
          
          storage.delete('finance-transactions');
          storage.delete('recurring-payments');
          storage.delete('debts');
          storage.delete('paid-recurring');
          storage.delete('custom-expense-categories');
          storage.delete('custom-income-categories');
          
          setTimeout(() => alert('All data cleared!'), 100);
        }
      };
      
      // Calculate totals
      const currentMonth = new Date().getMonth();
      const currentYear = new Date().getFullYear();
      const { financialMonth: currentFinancialMonth, financialYear: currentFinancialYear } = getFinancialMonth(getESTDateString());
      
      // Yearly totals (current financial year)
      const thisYearTransactions = transactions.filter(t => t.financialYear === currentFinancialYear);
      
      const yearlyIncome = thisYearTransactions
        .filter(t => t.type === 'income')
        .reduce((sum, t) => sum + t.amount, 0);
      
      const yearlyExpenses = thisYearTransactions
        .filter(t => t.type === 'expense')
        .reduce((sum, t) => sum + t.amount, 0);
      
      const yearlyNet = yearlyIncome - yearlyExpenses;
      const totalDebt = debts.reduce((sum, d) => sum + d.balance, 0);
      const totalRecurringMonthly = recurringPayments.reduce((sum, p) => sum + p.amount, 0);
      
      // Render
      return (
        <div className="min-h-screen bg-slate-950 p-4 md:p-8">
          <div className="max-w-7xl mx-auto">
            <h1 className="text-4xl font-bold mb-4 text-center bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
              Finance Tracker
            </h1>
            
            {/* Tab Navigation - Phase 1: Testing with 2 tabs */}
            <div className="flex gap-2 mb-6 overflow-x-auto">
              <button
                onClick={() => setActiveTab('dashboard')}
                className={`px-6 py-3 rounded-lg font-semibold whitespace-nowrap transition-colors ${
                  activeTab === 'dashboard'
                    ? 'bg-blue-600 text-white shadow-lg'
                    : 'bg-slate-800 text-slate-300 hover:bg-slate-700'
                }`}
              >
                üìä Dashboard
              </button>
              <button
                onClick={() => setActiveTab('debts')}
                className={`px-6 py-3 rounded-lg font-semibold whitespace-nowrap transition-colors ${
                  activeTab === 'debts'
                    ? 'bg-blue-600 text-white shadow-lg'
                    : 'bg-slate-800 text-slate-300 hover:bg-slate-700'
                }`}
              >
                üí≥ Debts ({debts.length})
              </button>
            </div>
            
            {/* Summary Cards - YEARLY */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
              <div className="bg-gradient-to-br from-green-500 to-green-700 rounded-lg p-6 shadow-lg">
                <div className="flex items-center gap-3 mb-2">
                  <TrendingUp size={24} />
                  <h2 className="text-sm font-semibold">Yearly Income</h2>
                </div>
                <p className="text-3xl font-bold">${formatCurrency(yearlyIncome)}</p>
                <p className="text-xs mt-1 opacity-80">Financial Year {currentFinancialYear}</p>
              </div>
              
              <div className="bg-gradient-to-br from-red-500 to-red-700 rounded-lg p-6 shadow-lg">
                <div className="flex items-center gap-3 mb-2">
                  <TrendingDown size={24} />
                  <h2 className="text-sm font-semibold">Yearly Expenses</h2>
                </div>
                <p className="text-3xl font-bold">${formatCurrency(yearlyExpenses)}</p>
                <p className="text-xs mt-1 opacity-80">Financial Year {currentFinancialYear}</p>
              </div>
              
              <div className={`bg-gradient-to-br ${yearlyNet >= 0 ? 'from-blue-500 to-blue-700' : 'from-orange-500 to-orange-700'} rounded-lg p-6 shadow-lg`}>
                <div className="flex items-center gap-3 mb-2">
                  <DollarSign size={24} />
                  <h2 className="text-sm font-semibold">Yearly Net</h2>
                </div>
                <p className="text-3xl font-bold">${formatCurrency(Math.abs(yearlyNet))}</p>
                <p className="text-xs mt-1">{yearlyNet >= 0 ? 'Surplus' : 'Deficit'}</p>
              </div>
            </div>
            
            {/* Header Actions */}
            <div className="flex justify-end gap-3 mb-8">
              <button onClick={exportData} className="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold flex items-center gap-2">
                <Download size={18} /> Export Data
              </button>
              <label className="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-semibold flex items-center gap-2 cursor-pointer">
                <Upload size={18} /> Import Data
                <input type="file" accept=".json" onChange={importData} className="hidden" />
              </label>
              <button onClick={clearAllData} className="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-semibold">
                Clear All Data
              </button>
            </div>
            
            {/* DEBT TRACKER - Only shows on Debts tab */}
            {activeTab === 'debts' && (
            <div className="bg-slate-800 rounded-lg border border-slate-700 mb-8">
              <div className="p-6 cursor-pointer hover:bg-slate-750 transition-colors" onClick={() => setIsDebtTrackerExpanded(!isDebtTrackerExpanded)}>
                <div className="flex justify-between items-center">
                  <div className="flex items-center gap-3">
                    {isDebtTrackerExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                    <h2 className="text-2xl font-bold">Debt Tracker</h2>
                  </div>
                  <div className="text-right">
                    <div className="text-2xl font-bold text-red-400">${formatCurrency(totalDebt)}</div>
                    <div className="text-xs text-slate-400">{debts.length} debts</div>
                  </div>
                </div>
              </div>
              
              {isDebtTrackerExpanded && (
                <div className="px-6 pb-6">
                  {debts.length === 0 ? (
                    <div className="text-center py-8 text-slate-400">
                      <p>No debts tracked yet.</p>
                      <p className="text-sm mt-2">Click "Add Debt" below to get started!</p>
                    </div>
                  ) : (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                      {debts.map(debt => {
                        const monthlyInterest = debt.balance * debt.apr / 100 / 12;
                        const principalPayment = debt.payment - monthlyInterest;
                        const monthlyRate = debt.apr / 100 / 12;
                        const monthsToPayoff = principalPayment > 0 ? Math.ceil(
                          Math.log(debt.payment / (debt.payment - debt.balance * monthlyRate)) / Math.log(1 + monthlyRate)
                        ) : 999;
                        const yearsToPayoff = Math.floor(monthsToPayoff / 12);
                        const remainingMonths = monthsToPayoff % 12;
                        const payoffDate = new Date();
                        payoffDate.setMonth(payoffDate.getMonth() + monthsToPayoff);
                        
                        return (
                          <div key={debt.id} className="bg-slate-900 rounded-lg p-4 border border-slate-700">
                            <div className="flex justify-between items-start mb-3">
                              <div>
                                <h3 className="text-lg font-bold text-white">{debt.name}</h3>
                                <div className="text-xs text-slate-400">Due: {debt.dueDay}{debt.dueDay === 1 ? 'st' : debt.dueDay === 2 ? 'nd' : debt.dueDay === 3 ? 'rd' : 'th'} of month</div>
                              </div>
                              <div className="flex items-center gap-3">
                                <button onClick={() => deleteDebt(debt.id)} className="p-1 hover:bg-slate-700 rounded" title="Delete Debt">
                                  <Trash2 size={16} className="text-red-400" />
                                </button>
                                <div className="text-right">
                                  <div className="text-2xl font-bold text-red-400">${formatCurrency(debt.balance)}</div>
                                  <div className="text-xs text-slate-400">Balance</div>
                                </div>
                              </div>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-2 text-sm mb-3">
                              <div className="bg-slate-800 rounded p-2">
                                <div className="text-xs text-slate-400">APR</div>
                                <div className="font-semibold text-blue-400">{debt.apr}%</div>
                              </div>
                              <div className="bg-slate-800 rounded p-2">
                                <div className="text-xs text-slate-400">Payment</div>
                                <div className="font-semibold text-purple-400">${formatCurrency(debt.payment)}</div>
                              </div>
                              <div className="bg-slate-800 rounded p-2">
                                <div className="text-xs text-slate-400">Interest/Month</div>
                                <div className="font-semibold text-yellow-400">${formatCurrency(monthlyInterest)}</div>
                              </div>
                              <div className="bg-slate-800 rounded p-2">
                                <div className="text-xs text-slate-400">Principal/Month</div>
                                <div className="font-semibold text-green-400">${formatCurrency(principalPayment)}</div>
                              </div>
                            </div>
                            
                            <div className="bg-slate-800 rounded-lg p-3 border-t border-slate-700">
                              <div className="flex justify-between items-center mb-2">
                                <div className="text-xs font-semibold text-slate-300">Payoff Projection</div>
                                {monthsToPayoff < 999 ? (
                                  <div className="text-xs text-blue-400">
                                    {yearsToPayoff > 0 && `${yearsToPayoff}y `}{remainingMonths}mo
                                  </div>
                                ) : (
                                  <div className="text-xs text-red-400">Interest Only</div>
                                )}
                              </div>
                              
                              {monthsToPayoff < 999 ? (
                                <>
                                  <div className="w-full bg-slate-700 rounded-full h-2 mb-2">
                                    <div className="bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 h-2 rounded-full" 
                                      style={{ width: `${Math.min(100, ((debt.originalBalance - debt.balance) / debt.originalBalance) * 100)}%` }}></div>
                                  </div>
                                  <div className="text-xs text-slate-400">
                                    <div className="flex justify-between">
                                      <span>Payoff Date:</span>
                                      <span className="text-slate-300">{payoffDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}</span>
                                    </div>
                                  </div>
                                </>
                              ) : (
                                <div className="text-xs text-red-400">‚ö†Ô∏è Payment doesn't cover interest. Balance will grow.</div>
                              )}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  )}
                  
                  {/* Add Debt Button/Form */}
                  <div className="mt-6">
                    {!showAddDebt ? (
                      <button onClick={() => setShowAddDebt(true)} className="w-full px-4 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold flex items-center justify-center gap-2">
                        <Plus size={20} /> Add Debt
                      </button>
                    ) : (
                      <div className="bg-slate-900 rounded-lg p-4 border border-slate-700">
                        <h3 className="text-lg font-semibold mb-4">Add New Debt</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div>
                            <label className="block text-sm text-slate-400 mb-1">Debt Name</label>
                            <input type="text" value={newDebt.name} onChange={(e) => setNewDebt({...newDebt, name: e.target.value})} className="w-full px-3 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-green-500 focus:outline-none" placeholder="e.g., Credit Card" />
                          </div>
                          <div>
                            <label className="block text-sm text-slate-400 mb-1">Current Balance ($)</label>
                            <input type="number" value={newDebt.balance} onChange={(e) => setNewDebt({...newDebt, balance: e.target.value})} className="w-full px-3 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-green-500 focus:outline-none" placeholder="0.00" />
                          </div>
                          <div>
                            <label className="block text-sm text-slate-400 mb-1">APR (%)</label>
                            <input type="number" step="0.01" value={newDebt.apr} onChange={(e) => setNewDebt({...newDebt, apr: e.target.value})} className="w-full px-3 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-green-500 focus:outline-none" placeholder="0.00" />
                          </div>
                          <div>
                            <label className="block text-sm text-slate-400 mb-1">Monthly Payment ($)</label>
                            <input type="number" value={newDebt.payment} onChange={(e) => setNewDebt({...newDebt, payment: e.target.value})} className="w-full px-3 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-green-500 focus:outline-none" placeholder="0.00" />
                          </div>
                          <div>
                            <label className="block text-sm text-slate-400 mb-1">Due Day</label>
                            <input type="number" min="1" max="31" value={newDebt.dueDay} onChange={(e) => setNewDebt({...newDebt, dueDay: e.target.value})} className="w-full px-3 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-green-500 focus:outline-none" />
                          </div>
                        </div>
                        <div className="flex gap-3 mt-4">
                          <button onClick={addDebt} className="flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-semibold">Add Debt</button>
                          <button onClick={() => { setShowAddDebt(false); setNewDebt({ name: '', balance: '', apr: '', payment: '', dueDay: 1 }); }} className="flex-1 px-4 py-2 bg-slate-600 hover:bg-slate-700 rounded-lg font-semibold">Cancel</button>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
            )}
            
            {/* RECURRING PAYMENTS - Always shows on Dashboard */}
            {activeTab === 'dashboard' && (
            <div className="bg-slate-800 rounded-lg border border-slate-700 mb-8">
              <div className="p-6 cursor-pointer hover:bg-slate-750 transition-colors" onClick={() => setIsRecurringExpanded(!isRecurringExpanded)}>
                <div className="flex justify-between items-center">
                  <div className="flex items-center gap-3">
                    {isRecurringExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                    <h2 className="text-2xl font-bold flex items-center gap-2">
                      <Calendar size={24} />
                      Recurring Payments
                    </h2>
                  </div>
                  <div className="text-right">
                    <div className="text-2xl font-bold text-orange-400">${formatCurrency(totalRecurringMonthly)}</div>
                    <div className="text-xs text-slate-400">{recurringPayments.filter(p => !isRecurringPaidThisMonth(p.id)).length} pending this month</div>
                  </div>
                </div>
              </div>
              
              {isRecurringExpanded && (
                <div className="px-6 pb-6">
                  {recurringPayments.length === 0 ? (
                    <div className="text-center py-8 text-slate-400">
                      <p>No recurring payments yet.</p>
                      <p className="text-sm mt-2">Click "Add Recurring Payment" below to get started!</p>
                    </div>
                  ) : (
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-6">
                      {recurringPayments.sort((a, b) => a.day - b.day).map(payment => {
                        const isPaid = isRecurringPaidThisMonth(payment.id);
                        return (
                          <div key={payment.id} className={`p-4 rounded-lg border ${isPaid ? 'bg-slate-900 border-green-500/30' : 'bg-slate-900 border-slate-700'}`}>
                            <div className="flex justify-between items-start mb-2">
                              <div className="flex-1">
                                <h4 className="font-semibold text-white">{payment.name}</h4>
                                <p className="text-xs text-slate-400">{payment.category}</p>
                              </div>
                              <div className="flex items-center gap-2">
                                <button onClick={() => deleteRecurringPayment(payment.id)} className="p-1 hover:bg-slate-700 rounded" title="Delete">
                                  <Trash2 size={14} className="text-red-400" />
                                </button>
                                <span className={`text-xs px-2 py-1 rounded ${payment.auto ? 'bg-blue-500/20 text-blue-400' : 'bg-yellow-500/20 text-yellow-400'}`}>
                                  {payment.auto ? 'Auto' : 'Manual'}
                                </span>
                              </div>
                            </div>
                            {isPaid && <div className="text-xs text-green-400 mb-2">‚úì Paid</div>}
                            <div className="text-xl font-bold text-white mb-1">${formatCurrency(payment.amount)}</div>
                            <div className="text-xs text-slate-400 mb-2">Due: {payment.day}{payment.day === 1 ? 'st' : payment.day === 2 ? 'nd' : payment.day === 3 ? 'rd' : 'th'}</div>
                            {payment.varies && <div className="text-xs text-yellow-400 mb-2">Amount varies</div>}
                            {!isPaid && (
                              <button onClick={() => markRecurringAsPaid(payment)} className="w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded font-semibold text-sm">
                                Mark as Paid
                              </button>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  )}
                  
                  {/* Add Recurring Payment Button/Form */}
                  <div className="mt-6">
                    {!showAddRecurring ? (
                      <button onClick={() => setShowAddRecurring(true)} className="w-full px-4 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold flex items-center justify-center gap-2">
                        <Plus size={20} /> Add Recurring Payment
                      </button>
                    ) : (
                      <div className="bg-slate-900 rounded-lg p-4 border border-slate-700">
                        <h3 className="text-lg font-semibold mb-4">Add New Recurring Payment</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div>
                            <label className="block text-sm text-slate-400 mb-1">Name</label>
                            <input type="text" value={newRecurring.name} onChange={(e) => setNewRecurring({...newRecurring, name: e.target.value})} className="w-full px-3 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-green-500 focus:outline-none" placeholder="e.g., Netflix" />
                          </div>
                          <div>
                            <label className="block text-sm text-slate-400 mb-1">Amount ($)</label>
                            <input type="number" value={newRecurring.amount} onChange={(e) => setNewRecurring({...newRecurring, amount: e.target.value})} className="w-full px-3 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-green-500 focus:outline-none" placeholder="0.00" />
                          </div>
                          <div>
                            <label className="block text-sm text-slate-400 mb-1">Category</label>
                            <select value={newRecurring.category} onChange={(e) => setNewRecurring({...newRecurring, category: e.target.value})} className="w-full px-3 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-green-500 focus:outline-none">
                              {expenseCategories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm text-slate-400 mb-1">Due Day</label>
                            <input type="number" min="1" max="31" value={newRecurring.day} onChange={(e) => setNewRecurring({...newRecurring, day: e.target.value})} className="w-full px-3 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-green-500 focus:outline-none" />
                          </div>
                          <div>
                            <label className="block text-sm text-slate-400 mb-1">Auto-add</label>
                            <select value={newRecurring.auto} onChange={(e) => setNewRecurring({...newRecurring, auto: e.target.value === 'true'})} className="w-full px-3 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-green-500 focus:outline-none">
                              <option value="true">Yes</option>
                              <option value="false">No (Manual)</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm text-slate-400 mb-1">Amount Varies</label>
                            <select value={newRecurring.varies} onChange={(e) => setNewRecurring({...newRecurring, varies: e.target.value === 'true'})} className="w-full px-3 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-green-500 focus:outline-none">
                              <option value="false">No (Fixed)</option>
                              <option value="true">Yes (Varies)</option>
                            </select>
                          </div>
                        </div>
                        <div className="flex gap-3 mt-4">
                          <button onClick={addRecurringPayment} className="flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-semibold">Add Payment</button>
                          <button onClick={() => { setShowAddRecurring(false); setNewRecurring({ name: '', amount: '', category: 'Subscriptions', day: 1, auto: true, varies: false }); }} className="flex-1 px-4 py-2 bg-slate-600 hover:bg-slate-700 rounded-lg font-semibold">Cancel</button>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
            
            {/* ADD TRANSACTION */}
            <div className="bg-slate-800 rounded-lg border border-slate-700 mb-8">
              <div className="p-6 cursor-pointer hover:bg-slate-750 transition-colors" onClick={() => setIsAddTransactionExpanded(!isAddTransactionExpanded)}>
                <div className="flex items-center gap-3">
                  {isAddTransactionExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                  <h2 className="text-2xl font-bold flex items-center gap-2">
                    <PlusCircle size={24} />
                    {editingId ? 'Edit Transaction' : 'Add Transaction'}
                  </h2>
                </div>
              </div>
              
              {isAddTransactionExpanded && (
                <div className="px-6 pb-6">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium mb-2">Type</label>
                      <select value={type} onChange={(e) => setType(e.target.value)} className="w-full px-4 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none">
                        <option value="expense">Expense</option>
                        <option value="income">Income</option>
                      </select>
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium mb-2">Date</label>
                      <input type="date" value={date} onChange={(e) => setDate(e.target.value)} className="w-full px-4 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none" />
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium mb-2">Description</label>
                      <input type="text" value={description} onChange={(e) => setDescription(e.target.value)} placeholder="What was this for?" className="w-full px-4 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none" />
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium mb-2">Amount</label>
                      <input type="number" step="0.01" value={amount} onChange={(e) => setAmount(e.target.value)} placeholder="0.00" className="w-full px-4 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none" />
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium mb-2">Category</label>
                      <select value={showCustomCategory ? 'custom' : category} onChange={(e) => { if (e.target.value === 'custom') { setShowCustomCategory(true); setCategory(''); } else { setShowCustomCategory(false); setCategory(e.target.value); } }} className="w-full px-4 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none">
                        <option value="">Select category</option>
                        {(type === 'expense' ? expenseCategories : incomeCategories).map(cat => <option key={cat} value={cat}>{cat}</option>)}
                        <option value="custom">+ Custom Category</option>
                      </select>
                    </div>
                    
                    {showCustomCategory && (
                      <div>
                        <label className="block text-sm font-medium mb-2">Custom Category</label>
                        <input type="text" value={customCategory} onChange={(e) => setCustomCategory(e.target.value)} placeholder="Enter category name" className="w-full px-4 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none" />
                      </div>
                    )}
                  </div>
                  
                  <div className="flex gap-3 mt-4">
                    <button onClick={addTransaction} className="flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold text-lg">
                      {editingId ? 'Update' : 'Add'} Transaction
                    </button>
                    {editingId && (
                      <button onClick={() => { resetForm(); setEditingId(null); }} className="px-6 py-3 bg-slate-600 hover:bg-slate-700 rounded-lg font-semibold">Cancel</button>
                    )}
                  </div>
                </div>
              )}
            </div>
            
            {/* YEARLY CATEGORY ANALYSIS */}
            {transactions.length > 0 && (
              <div className="bg-slate-800 rounded-lg border border-slate-700 mb-8">
                <div className="p-6 cursor-pointer hover:bg-slate-750 transition-colors" onClick={() => setIsYearlyAnalysisExpanded(!isYearlyAnalysisExpanded)}>
                  <div className="flex items-center gap-3">
                    {isYearlyAnalysisExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                    <h2 className="text-2xl font-bold">Yearly Category Analysis</h2>
                  </div>
                </div>
                
                {isYearlyAnalysisExpanded && (
                  <div className="px-6 pb-6">
                    {['expense', 'income'].map(txType => {
                      const yearlyData = {};
                      const yearlyTransactions = {};
                      
                      transactions.filter(t => t.type === txType).forEach(t => {
                        const yearKey = t.financialYear;
                        if (!yearlyData[yearKey]) yearlyData[yearKey] = {};
                        if (!yearlyTransactions[yearKey]) yearlyTransactions[yearKey] = {};
                        if (!yearlyData[yearKey][t.category]) {
                          yearlyData[yearKey][t.category] = 0;
                          yearlyTransactions[yearKey][t.category] = [];
                        }
                        yearlyData[yearKey][t.category] += t.amount;
                        yearlyTransactions[yearKey][t.category].push(t);
                      });
                      
                      return Object.keys(yearlyData).length > 0 && (
                        <div key={txType} className="mb-6">
                          <h3 className="text-xl font-semibold mb-4 capitalize text-white">{txType}s by Category</h3>
                          {Object.keys(yearlyData).sort((a, b) => b - a).map(year => (
                            <div key={year} className="mb-4">
                              <h4 className="text-lg font-semibold mb-2 text-slate-300">{year}</h4>
                              <div className="space-y-2">
                                {Object.entries(yearlyData[year])
                                  .sort((a, b) => b[1] - a[1])
                                  .map(([category, amount]) => {
                                    const categoryKey = `${txType}-${year}-${category}`;
                                    const isExpanded = expandedCategories[categoryKey];
                                    const categoryTransactions = yearlyTransactions[year][category];
                                    
                                    return (
                                      <div key={category} className="bg-slate-900 rounded-lg overflow-hidden">
                                        <div 
                                          className="p-3 cursor-pointer hover:bg-slate-800 transition-colors"
                                          onClick={() => setExpandedCategories(prev => ({ ...prev, [categoryKey]: !isExpanded }))}
                                        >
                                          <div className="flex justify-between items-center">
                                            <div className="flex items-center gap-2">
                                              {isExpanded ? <ChevronUp size={16} /> : <ChevronDown size={16} />}
                                              <span className="font-medium">{category}</span>
                                              <span className="text-xs text-slate-400">({categoryTransactions.length} transactions)</span>
                                            </div>
                                            <span className={`font-bold ${txType === 'income' ? 'text-green-400' : 'text-red-400'}`}>
                                              ${formatCurrency(amount)}
                                            </span>
                                          </div>
                                        </div>
                                        
                                        {isExpanded && (
                                          <div className="px-3 pb-3 space-y-1">
                                            {categoryTransactions.sort((a, b) => new Date(b.date) - new Date(a.date)).map(t => (
                                              <div key={t.id} className="flex justify-between items-center p-2 bg-slate-800 rounded text-sm">
                                                <div className="flex items-center gap-2">
                                                  <span className="text-slate-300">{t.description}</span>
                                                  <span className="text-slate-500 text-xs">{t.date}</span>
                                                </div>
                                                <span className={`font-semibold ${txType === 'income' ? 'text-green-400' : 'text-red-400'}`}>
                                                  ${formatCurrency(t.amount)}
                                                </span>
                                              </div>
                                            ))}
                                          </div>
                                        )}
                                      </div>
                                    );
                                  })}
                              </div>
                            </div>
                          ))}
                        </div>
                      );
                    })}
                  </div>
                )}
              </div>
            )}
            
            {/* TRANSACTIONS LIST - MONTHLY BREAKDOWN */}
            {transactions.length > 0 && (
              <div className="bg-slate-800 rounded-lg border border-slate-700">
                <div className="p-6">
                  <h2 className="text-2xl font-bold mb-4">Transactions by Month</h2>
                  {Object.entries(
                    transactions.reduce((acc, t) => {
                      const monthKey = `${t.financialYear}-${String(t.financialMonth).padStart(2, '0')}`;
                      if (!acc[monthKey]) acc[monthKey] = [];
                      acc[monthKey].push(t);
                      return acc;
                    }, {})
                  )
                  .sort((a, b) => b[0].localeCompare(a[0]))
                  .map(([monthKey, monthTransactions]) => {
                    const [year, month] = monthKey.split('-');
                    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    const monthName = monthNames[parseInt(month)];
                    
                    const monthIncome = monthTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                    const monthExpenses = monthTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                    const monthNet = monthIncome - monthExpenses;
                    const isExpanded = expandedMonths[monthKey] === true; // Default to collapsed
                    
                    return (
                      <div key={monthKey} className="mb-6">
                        <div 
                          className="flex justify-between items-center mb-3 pb-2 border-b border-slate-700 cursor-pointer hover:bg-slate-700/30 p-2 rounded transition-colors"
                          onClick={() => setExpandedMonths(prev => ({ ...prev, [monthKey]: !isExpanded }))}
                        >
                          <div className="flex items-center gap-3">
                            {isExpanded ? <ChevronUp size={18} /> : <ChevronDown size={18} />}
                            <h3 className="text-xl font-semibold text-white">{monthName} {year}</h3>
                          </div>
                          <div className="flex gap-4 text-sm">
                            <span className="text-green-400">Income: ${formatCurrency(monthIncome)}</span>
                            <span className="text-red-400">Expenses: ${formatCurrency(monthExpenses)}</span>
                            <span className={monthNet >= 0 ? 'text-blue-400' : 'text-orange-400'}>
                              Net: ${formatCurrency(Math.abs(monthNet))} {monthNet >= 0 ? '‚Üë' : '‚Üì'}
                            </span>
                          </div>
                        </div>
                        
                        {isExpanded && (
                          <div className="space-y-2">
                            {monthTransactions.sort((a, b) => new Date(b.date) - new Date(a.date)).map(t => {
                              // Check if this transaction matches a recurring payment
                              const normalizeForMatch = (name) => name.toLowerCase().replace(/[^a-z0-9]/g, '');
                              const isRecurring = recurringPayments.some(p => 
                                normalizeForMatch(p.name) === normalizeForMatch(t.description)
                              );
                              
                              return (
                                <div key={t.id} className="flex justify-between items-center p-3 bg-slate-900 rounded-lg hover:bg-slate-700 transition-colors">
                                  <div className="flex-1">
                                    <div className="flex items-center gap-3">
                                      <span className={`px-2 py-1 rounded text-xs font-semibold ${t.type === 'income' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`}>{t.type}</span>
                                      <span className="font-medium">{isRecurring && 'üîÑ '}{t.description}</span>
                                      <span className="text-slate-400 text-sm">({t.category})</span>
                                    </div>
                                    <div className="text-sm text-slate-400 mt-1">{t.date}</div>
                                  </div>
                                  <div className="flex items-center gap-4">
                                    <span className={`text-lg font-bold ${t.type === 'income' ? 'text-green-400' : 'text-red-400'}`}>
                                      {t.type === 'income' ? '+' : '-'}${formatCurrency(t.amount)}
                                    </span>
                                    <button onClick={(e) => { e.stopPropagation(); editTransaction(t); }} className="p-2 hover:bg-slate-600 rounded transition-colors" title="Edit">
                                      <Edit2 size={16} className="text-blue-400" />
                                    </button>
                                    <button onClick={(e) => { e.stopPropagation(); deleteTransaction(t.id); }} className="p-2 hover:bg-slate-600 rounded transition-colors" title="Delete">
                                      <Trash2 size={16} />
                                    </button>
                                  </div>
                                </div>
                              );
                            })}
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            )}
          </div>
          )}
          
          {/* Version Number */}
          <div className="fixed bottom-4 left-4 text-slate-500 text-xs">
            v1.2.0-beta (Phase 1: Testing Tabs)
          </div>
        </div>
      );
    };
    
    // Render app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<FinanceTracker />);
  </script>
</body>
</html>
