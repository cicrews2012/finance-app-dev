<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Tracker v1.3.0-beta</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        #root {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .app-container {
            background: #0f1419;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header .version {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .tab-navigation {
            display: flex;
            background: #1a1f2e;
            border-bottom: 2px solid #2d3748;
            overflow-x: auto;
        }
        
        .tab-button {
            flex: 1;
            min-width: 150px;
            padding: 18px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #a0aec0;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .tab-button:hover {
            background: #2d3748;
            color: #e2e8f0;
        }
        
        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: #0f1419;
        }
        
        .tab-content {
            padding: 30px;
            background: #0f1419;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .summary-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .summary-card .amount {
            font-size: 2em;
            font-weight: 700;
        }

        .summary-card .subtitle {
            font-size: 0.85em;
            opacity: 0.85;
            margin-top: 8px;
        }
        
        .section {
            background: #1a1f2e;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 968px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-container {
            background: #0f1419;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            border: 1px solid #2d3748;
        }

        .chart-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 15px;
        }

        .category-bar {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .category-label {
            width: 120px;
            font-size: 0.9em;
            color: #a0aec0;
            font-weight: 500;
        }

        .category-bar-bg {
            flex: 1;
            height: 30px;
            background: #2d3748;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .category-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            padding-left: 10px;
            color: white;
            font-size: 0.85em;
            font-weight: 600;
        }

        .debt-overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .debt-mini-card {
            background: #1a1f2e;
            padding: 18px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            border-left: 4px solid #ffc107;
        }

        .debt-mini-card h4 {
            color: #e2e8f0;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .debt-mini-card .debt-amount {
            font-size: 1.4em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .debt-mini-card .debt-info {
            font-size: 0.85em;
            color: #a0aec0;
            margin-bottom: 4px;
        }

        .upcoming-payments-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .upcoming-payment-item {
            background: #1a1f2e;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .payment-date {
            background: #667eea;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9em;
            min-width: 60px;
            text-align: center;
        }

        .payment-info {
            flex: 1;
            margin-left: 15px;
        }

        .payment-info h4 {
            color: #e2e8f0;
            margin-bottom: 4px;
        }

        .payment-info p {
            color: #a0aec0;
            font-size: 0.85em;
        }

        .payment-amount {
            font-size: 1.2em;
            font-weight: 700;
            color: #dc3545;
        }

        .health-score-container {
            text-align: center;
            padding: 20px;
        }

        .health-score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            font-weight: 700;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .health-score-circle.excellent {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .health-score-circle.good {
            background: linear-gradient(135deg, #20c997, #17a2b8);
        }

        .health-score-circle.fair {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
        }

        .health-score-circle.poor {
            background: linear-gradient(135deg, #fd7e14, #dc3545);
        }

        .health-score-label {
            font-size: 1.1em;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }

        .health-score-description {
            font-size: 0.9em;
            color: #6c757d;
            line-height: 1.5;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #a0aec0;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #2d3748;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            background: #0f1419;
            color: #e2e8f0;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.secondary {
            background: #6c757d;
            margin-left: 10px;
        }
        
        button.danger {
            background: #dc3545;
        }
        
        .transaction-list, .payment-list, .debt-list {
            margin-top: 20px;
        }
        
        .transaction-item, .payment-item, .debt-item {
            background: #1a1f2e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .transaction-item.income {
            border-left: 4px solid #28a745;
        }
        
        .transaction-item.expense {
            border-left: 4px solid #dc3545;
        }
        
        .item-details h4 {
            color: #e2e8f0;
            margin-bottom: 5px;
        }
        
        .item-details p {
            color: #a0aec0;
            font-size: 0.9em;
        }
        
        .item-amount {
            font-size: 1.3em;
            font-weight: 700;
        }
        
        .item-amount.positive {
            color: #28a745;
        }
        
        .item-amount.negative {
            color: #dc3545;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .collapsible-section {
            margin-bottom: 15px;
        }
        
        .collapsible-header {
            background: #667eea;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }
        
        .collapsible-header:hover {
            background: #5568d3;
        }
        
        .collapsible-header h3 {
            margin: 0;
            font-size: 1.2em;
        }
        
        .collapsible-content {
            padding: 20px;
            background: #0f1419;
            border-radius: 0 0 10px 10px;
            margin-top: 2px;
        }
        
        .debt-item {
            border-left: 4px solid #ffc107;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #2d3748;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }
        
        .debt-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        .debt-detail-item {
            padding: 10px;
            background: #1a1f2e;
            border-radius: 5px;
        }
        
        .debt-detail-item label {
            font-size: 0.8em;
            color: #a0aec0;
            margin-bottom: 5px;
        }
        
        .debt-detail-item .value {
            font-weight: 700;
            color: #e2e8f0;
        }
        
        @media (max-width: 768px) {
            .tab-navigation {
                flex-wrap: wrap;
            }
            
            .tab-button {
                flex: 1 1 50%;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }

            .category-label {
                width: 80px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Utility function to format currency
        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        };

        // Financial month calculation (28th to 27th)
        const getCurrentFinancialMonth = () => {
            const today = new Date();
            const day = today.getDate();
            const month = today.getMonth();
            const year = today.getFullYear();
            
            if (day >= 28) {
                return new Date(year, month + 1, 1);
            } else {
                return new Date(year, month, 1);
            }
        };

        const getFinancialMonthRange = (date) => {
            const month = date.getMonth();
            const year = date.getFullYear();
            
            const start = new Date(year, month - 1, 28);
            const end = new Date(year, month, 27, 23, 59, 59);
            
            return { start, end };
        };

        function FinanceTracker() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [transactions, setTransactions] = useState([]);
            const [recurringPayments, setRecurringPayments] = useState([]);
            const [debts, setDebts] = useState([]);
            const [currentMonth, setCurrentMonth] = useState(getCurrentFinancialMonth());

            // Load data from localStorage on mount
            useEffect(() => {
                const savedTransactions = localStorage.getItem('transactions');
                const savedPayments = localStorage.getItem('recurringPayments');
                const savedDebts = localStorage.getItem('debts');
                
                if (savedTransactions) setTransactions(JSON.parse(savedTransactions));
                if (savedPayments) setRecurringPayments(JSON.parse(savedPayments));
                if (savedDebts) setDebts(JSON.parse(savedDebts));
            }, []);

            // Save data to localStorage whenever it changes
            useEffect(() => {
                localStorage.setItem('transactions', JSON.stringify(transactions));
            }, [transactions]);

            useEffect(() => {
                localStorage.setItem('recurringPayments', JSON.stringify(recurringPayments));
            }, [recurringPayments]);

            useEffect(() => {
                localStorage.setItem('debts', JSON.stringify(debts));
            }, [debts]);

            // Calculate monthly totals
            const getMonthlyTotals = () => {
                const { start, end } = getFinancialMonthRange(currentMonth);
                
                const monthlyTransactions = transactions.filter(t => {
                    const tDate = new Date(t.date);
                    return tDate >= start && tDate <= end;
                });

                const income = monthlyTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + parseFloat(t.amount), 0);

                const expenses = monthlyTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + parseFloat(t.amount), 0);

                const recurringTotal = recurringPayments.reduce((sum, p) => sum + parseFloat(p.amount), 0);

                return {
                    income,
                    expenses: expenses + recurringTotal,
                    net: income - (expenses + recurringTotal)
                };
            };

            // Calculate total debt
            const getTotalDebt = () => {
                return debts.reduce((sum, d) => sum + parseFloat(d.currentBalance), 0);
            };

            // Export data
            const exportData = () => {
                const data = {
                    transactions,
                    recurringPayments,
                    debts,
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `finance-tracker-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
            };

            // Import data
            const importData = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            // Parse and validate transactions
                            if (data.transactions) {
                                const validTransactions = data.transactions.map(t => ({
                                    ...t,
                                    amount: parseFloat(t.amount) || 0,
                                    id: t.id || Date.now() + Math.random()
                                }));
                                setTransactions(validTransactions);
                            }
                            
                            // Parse and validate recurring payments
                            if (data.recurringPayments) {
                                const validPayments = data.recurringPayments.map(p => ({
                                    name: p.name,
                                    amount: parseFloat(p.amount) || 0,
                                    category: p.category || '',
                                    dueDay: parseInt(p.dueDay || p.day) || 1,
                                    linkedDebt: p.linkedDebt || '',
                                    id: p.id || Date.now() + Math.random()
                                }));
                                setRecurringPayments(validPayments);
                            }
                            
                            // Parse and validate debts - handle BOTH old and new formats
                            if (data.debts) {
                                const validDebts = data.debts.map(d => {
                                    // Old format uses: balance, apr, payment
                                    // New format uses: currentBalance, interestRate, minimumPayment
                                    const currentBalance = parseFloat(d.currentBalance || d.balance) || 0;
                                    const originalBalance = parseFloat(d.originalBalance) || currentBalance;
                                    
                                    return {
                                        name: d.name,
                                        originalBalance: originalBalance,
                                        currentBalance: currentBalance,
                                        interestRate: parseFloat(d.interestRate || d.apr) || 0,
                                        minimumPayment: parseFloat(d.minimumPayment || d.payment) || 0,
                                        category: d.category || 'Other',
                                        id: d.id || Date.now() + Math.random()
                                    };
                                });
                                setDebts(validDebts);
                            }
                            
                            alert('Data imported successfully!');
                        } catch (error) {
                            alert('Error importing data. Please check the file format.\n\nError: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
                // Reset the file input so the same file can be imported again
                event.target.value = '';
            };

            // Clear all data
            const clearAllData = () => {
                if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                    setTransactions([]);
                    setRecurringPayments([]);
                    setDebts([]);
                    localStorage.clear();
                }
            };

            const totals = getMonthlyTotals();
            const totalDebt = getTotalDebt();

            return (
                <div className="app-container">
                    <div className="header">
                        <h1>üí∞ Finance Tracker</h1>
                        <div className="version">v1.4.0-beta | Dark Mode + Payoff Strategies</div>
                    </div>

                    <div className="tab-navigation">
                        <button 
                            className={`tab-button ${activeTab === 'dashboard' ? 'active' : ''}`}
                            onClick={() => setActiveTab('dashboard')}
                        >
                            üìä Dashboard
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'transactions' ? 'active' : ''}`}
                            onClick={() => setActiveTab('transactions')}
                        >
                            üí≥ Transactions
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'recurring' ? 'active' : ''}`}
                            onClick={() => setActiveTab('recurring')}
                        >
                            üîÑ Recurring
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'debts' ? 'active' : ''}`}
                            onClick={() => setActiveTab('debts')}
                        >
                            üìâ Debt Tracking
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'payoff' ? 'active' : ''}`}
                            onClick={() => setActiveTab('payoff')}
                        >
                            üéØ Payoff Strategies
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'settings' ? 'active' : ''}`}
                            onClick={() => setActiveTab('settings')}
                        >
                            ‚öôÔ∏è Settings
                        </button>
                    </div>

                    <div className="tab-content">
                        {activeTab === 'dashboard' && (
                            <DashboardTab 
                                totals={totals}
                                totalDebt={totalDebt}
                                currentMonth={currentMonth}
                                transactions={transactions}
                                recurringPayments={recurringPayments}
                                debts={debts}
                            />
                        )}
                        {activeTab === 'transactions' && (
                            <TransactionsTab 
                                transactions={transactions}
                                setTransactions={setTransactions}
                                currentMonth={currentMonth}
                            />
                        )}
                        {activeTab === 'recurring' && (
                            <RecurringTab 
                                recurringPayments={recurringPayments}
                                setRecurringPayments={setRecurringPayments}
                                debts={debts}
                                setDebts={setDebts}
                                transactions={transactions}
                                setTransactions={setTransactions}
                            />
                        )}
                        {activeTab === 'debts' && (
                            <DebtsTab 
                                debts={debts}
                                setDebts={setDebts}
                            />
                        )}
                        {activeTab === 'payoff' && (
                            <PayoffStrategiesTab 
                                debts={debts}
                            />
                        )}
                        {activeTab === 'settings' && (
                            <SettingsTab 
                                exportData={exportData}
                                importData={importData}
                                clearAllData={clearAllData}
                            />
                        )}
                    </div>
                </div>
            );
        }

        // Dashboard Tab Component - ENHANCED
        function DashboardTab({ totals, totalDebt, currentMonth, transactions, recurringPayments, debts }) {
            const monthName = currentMonth.toLocaleString('default', { month: 'long', year: 'numeric' });
            const { start, end } = getFinancialMonthRange(currentMonth);

            // Calculate spending by category
            const getSpendingByCategory = () => {
                const { start, end } = getFinancialMonthRange(currentMonth);
                const categoryTotals = {};
                
                // Add transaction expenses
                transactions.filter(t => {
                    const tDate = new Date(t.date);
                    return t.type === 'expense' && tDate >= start && tDate <= end;
                }).forEach(t => {
                    const category = t.category || 'Uncategorized';
                    const amount = parseFloat(t.amount) || 0;
                    categoryTotals[category] = (categoryTotals[category] || 0) + amount;
                });

                // Add recurring payment expenses
                recurringPayments.forEach(p => {
                    const category = p.category || 'Recurring';
                    const amount = parseFloat(p.amount) || 0;
                    categoryTotals[category] = (categoryTotals[category] || 0) + amount;
                });

                return Object.entries(categoryTotals)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 8);
            };

            // Get upcoming payments this month
            const getUpcomingPayments = () => {
                const today = new Date();
                const currentDay = today.getDate();
                
                return recurringPayments
                    .map(p => ({...p}))
                    .sort((a, b) => a.dueDay - b.dueDay)
                    .filter(p => p.dueDay >= currentDay || currentDay > 27);
            };

            // Calculate financial health score
            const getHealthScore = () => {
                if (totals.income === 0) return { score: 0, rating: 'N/A', description: 'No income data' };
                
                const debtToIncome = totalDebt / totals.income;
                const savingsRate = totals.net / totals.income;
                
                let score = 100;
                let rating = 'Excellent';
                let description = 'Your finances are in great shape!';

                // Debt-to-income impact
                if (debtToIncome > 3) {
                    score -= 40;
                    rating = 'Poor';
                    description = 'High debt-to-income ratio. Focus on debt reduction.';
                } else if (debtToIncome > 2) {
                    score -= 25;
                    rating = 'Fair';
                    description = 'Moderate debt levels. Consider accelerating payments.';
                } else if (debtToIncome > 1) {
                    score -= 10;
                    rating = 'Good';
                    description = 'Manageable debt levels. Keep up the good work!';
                }

                // Savings rate impact
                if (savingsRate < 0) {
                    score -= 30;
                    rating = 'Poor';
                    description = 'Spending exceeds income. Review expenses urgently.';
                } else if (savingsRate < 0.1) {
                    score -= 15;
                    if (rating !== 'Poor') rating = 'Fair';
                    description = 'Low savings rate. Try to reduce expenses.';
                }

                score = Math.max(0, Math.min(100, score));

                return { score, rating, description };
            };

            const spendingData = getSpendingByCategory();
            const upcomingPayments = getUpcomingPayments();
            const healthScore = getHealthScore();
            const maxSpending = spendingData.length > 0 ? spendingData[0][1] : 1;

            return (
                <div>
                    <h2 style={{color: '#667eea', marginBottom: '20px'}}>
                        Financial Overview - {monthName}
                    </h2>
                    <p style={{color: '#6c757d', marginBottom: '20px'}}>
                        Period: {start.toLocaleDateString()} - {end.toLocaleDateString()}
                    </p>

                    <div className="summary-grid">
                        <div className="summary-card">
                            <h3>Total Income</h3>
                            <div className="amount">{formatCurrency(totals.income)}</div>
                        </div>
                        <div className="summary-card">
                            <h3>Total Expenses</h3>
                            <div className="amount">{formatCurrency(totals.expenses)}</div>
                            <div className="subtitle">
                                {recurringPayments.length} recurring payments
                            </div>
                        </div>
                        <div className="summary-card">
                            <h3>Net Balance</h3>
                            <div className="amount">{formatCurrency(totals.net)}</div>
                            <div className="subtitle">
                                {totals.income > 0 ? ((totals.net / totals.income) * 100).toFixed(1) : 0}% of income
                            </div>
                        </div>
                        <div className="summary-card">
                            <h3>Total Debt</h3>
                            <div className="amount">{formatCurrency(totalDebt)}</div>
                            <div className="subtitle">
                                {debts.length} active debt{debts.length !== 1 ? 's' : ''}
                            </div>
                        </div>
                    </div>

                    <div className="dashboard-grid">
                        {/* Spending Breakdown */}
                        <div className="section">
                            <h2>Spending Breakdown</h2>
                            <div className="chart-container">
                                <div className="chart-title">Top Categories This Month</div>
                                {spendingData.length === 0 ? (
                                    <p style={{color: '#6c757d', textAlign: 'center', padding: '20px'}}>
                                        No spending data for this month
                                    </p>
                                ) : (
                                    spendingData.map(([category, amount]) => (
                                        <div key={category} className="category-bar">
                                            <div className="category-label">{category}</div>
                                            <div className="category-bar-bg">
                                                <div 
                                                    className="category-bar-fill"
                                                    style={{width: `${(amount / maxSpending) * 100}%`}}
                                                >
                                                    {formatCurrency(amount)}
                                                </div>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>

                        {/* Financial Health Score */}
                        <div className="section">
                            <h2>Financial Health</h2>
                            <div className="chart-container">
                                <div className="health-score-container">
                                    <div className={`health-score-circle ${healthScore.rating.toLowerCase()}`}>
                                        {healthScore.score}
                                    </div>
                                    <div className="health-score-label">{healthScore.rating}</div>
                                    <div className="health-score-description">{healthScore.description}</div>
                                    {totals.income > 0 && (
                                        <div style={{marginTop: '15px', fontSize: '0.85em', color: '#6c757d'}}>
                                            <div>Debt-to-Income: {(totalDebt / totals.income).toFixed(2)}x</div>
                                            <div>Savings Rate: {((totals.net / totals.income) * 100).toFixed(1)}%</div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Debt Overview */}
                    {debts.length > 0 && (
                        <div className="section">
                            <h2>Debt Overview</h2>
                            <div className="debt-overview-grid">
                                {debts.map(debt => {
                                    const originalBalance = parseFloat(debt.originalBalance) || 0;
                                    const currentBalance = parseFloat(debt.currentBalance) || 0;
                                    const interestRate = parseFloat(debt.interestRate) || 0;
                                    const progressPercent = originalBalance > 0 
                                        ? ((originalBalance - currentBalance) / originalBalance * 100)
                                        : 0;
                                    return (
                                        <div key={debt.id} className="debt-mini-card">
                                            <h4>{debt.name}</h4>
                                            <div className="debt-amount">{formatCurrency(currentBalance)}</div>
                                            <div className="debt-info">{debt.category}</div>
                                            <div className="debt-info">{interestRate.toFixed(2)}% APR</div>
                                            <div className="progress-bar" style={{marginTop: '8px'}}>
                                                <div 
                                                    className="progress-fill" 
                                                    style={{width: `${Math.min(progressPercent, 100)}%`}}
                                                ></div>
                                            </div>
                                            <div className="debt-info" style={{marginTop: '5px'}}>
                                                {progressPercent.toFixed(1)}% paid off
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}

                    {/* Upcoming Payments */}
                    <div className="section">
                        <h2>Upcoming Payments</h2>
                        <div className="upcoming-payments-list">
                            {upcomingPayments.length === 0 ? (
                                <p style={{color: '#6c757d', textAlign: 'center', padding: '20px'}}>
                                    No upcoming payments this month
                                </p>
                            ) : (
                                upcomingPayments.map(payment => {
                                    const amount = parseFloat(payment.amount) || 0;
                                    return (
                                        <div key={payment.id} className="upcoming-payment-item">
                                            <div className="payment-date">
                                                Day {payment.dueDay}
                                            </div>
                                            <div className="payment-info">
                                                <h4>{payment.name}</h4>
                                                <p>{payment.category}</p>
                                            </div>
                                            <div className="payment-amount">
                                                {formatCurrency(amount)}
                                            </div>
                                        </div>
                                    );
                                })
                            )}
                        </div>
                    </div>

                    {/* Recent Transactions */}
                    <div className="section">
                        <h2>Recent Transactions</h2>
                        <div className="transaction-list">
                            {transactions.length === 0 ? (
                                <p style={{color: '#6c757d', textAlign: 'center', padding: '20px'}}>
                                    No transactions yet. Add your first transaction in the Transactions tab.
                                </p>
                            ) : (
                                transactions.slice(-5).reverse().map((transaction, index) => (
                                    <div key={index} className={`transaction-item ${transaction.type}`}>
                                        <div className="item-details">
                                            <h4>{transaction.description}</h4>
                                            <p>{transaction.category} ‚Ä¢ {new Date(transaction.date).toLocaleDateString()}</p>
                                        </div>
                                        <div className={`item-amount ${transaction.type === 'income' ? 'positive' : 'negative'}`}>
                                            {transaction.type === 'income' ? '+' : '-'}{formatCurrency(Math.abs(transaction.amount))}
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Transactions Tab Component
        function TransactionsTab({ transactions, setTransactions, currentMonth }) {
            const [formData, setFormData] = useState({
                type: 'expense',
                amount: '',
                description: '',
                category: '',
                date: new Date().toISOString().split('T')[0]
            });

            const [expandedMonths, setExpandedMonths] = useState({});

            const handleSubmit = (e) => {
                e.preventDefault();
                if (formData.amount && formData.description) {
                    setTransactions([...transactions, {
                        ...formData,
                        amount: parseFloat(formData.amount),
                        id: Date.now()
                    }]);
                    setFormData({
                        type: 'expense',
                        amount: '',
                        description: '',
                        category: '',
                        date: new Date().toISOString().split('T')[0]
                    });
                }
            };

            const deleteTransaction = (id) => {
                setTransactions(transactions.filter(t => t.id !== id));
            };

            const toggleMonth = (monthKey) => {
                setExpandedMonths(prev => ({
                    ...prev,
                    [monthKey]: !prev[monthKey]
                }));
            };

            // Group transactions by month
            const groupTransactionsByMonth = () => {
                const grouped = {};
                
                transactions.forEach(transaction => {
                    const date = new Date(transaction.date);
                    const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                    const monthLabel = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                    
                    if (!grouped[monthKey]) {
                        grouped[monthKey] = {
                            label: monthLabel,
                            transactions: [],
                            income: 0,
                            expenses: 0
                        };
                    }
                    
                    grouped[monthKey].transactions.push(transaction);
                    
                    const amount = parseFloat(transaction.amount) || 0;
                    if (transaction.type === 'income') {
                        grouped[monthKey].income += amount;
                    } else {
                        grouped[monthKey].expenses += amount;
                    }
                });

                // Sort by month (newest first)
                return Object.entries(grouped).sort((a, b) => b[0].localeCompare(a[0]));
            };

            const monthlyGroups = groupTransactionsByMonth();

            return (
                <div>
                    <div className="section">
                        <h2>Add New Transaction</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Type</label>
                                    <select 
                                        value={formData.type}
                                        onChange={(e) => setFormData({...formData, type: e.target.value})}
                                    >
                                        <option value="income">Income</option>
                                        <option value="expense">Expense</option>
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label>Amount</label>
                                    <input 
                                        type="number" 
                                        step="0.01"
                                        value={formData.amount}
                                        onChange={(e) => setFormData({...formData, amount: e.target.value})}
                                        placeholder="0.00"
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Date</label>
                                    <input 
                                        type="date"
                                        value={formData.date}
                                        onChange={(e) => setFormData({...formData, date: e.target.value})}
                                        required
                                    />
                                </div>
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Description</label>
                                    <input 
                                        type="text"
                                        value={formData.description}
                                        onChange={(e) => setFormData({...formData, description: e.target.value})}
                                        placeholder="e.g., Grocery shopping"
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Category</label>
                                    <input 
                                        type="text"
                                        value={formData.category}
                                        onChange={(e) => setFormData({...formData, category: e.target.value})}
                                        placeholder="e.g., Food, Utilities"
                                    />
                                </div>
                            </div>
                            <button type="submit">Add Transaction</button>
                        </form>
                    </div>

                    <div className="section">
                        <h2>Transaction History</h2>
                        {monthlyGroups.length === 0 ? (
                            <p style={{color: '#6c757d', textAlign: 'center', padding: '20px'}}>
                                No transactions yet.
                            </p>
                        ) : (
                            monthlyGroups.map(([monthKey, data]) => (
                                <div key={monthKey} className="collapsible-section">
                                    <div 
                                        className="collapsible-header"
                                        onClick={() => toggleMonth(monthKey)}
                                    >
                                        <div>
                                            <h3>{data.label}</h3>
                                            <p style={{fontSize: '0.9em', marginTop: '5px', opacity: 0.9}}>
                                                {data.transactions.length} transaction{data.transactions.length !== 1 ? 's' : ''} ‚Ä¢ 
                                                Income: {formatCurrency(data.income)} ‚Ä¢ 
                                                Expenses: {formatCurrency(data.expenses)}
                                            </p>
                                        </div>
                                        <div style={{fontSize: '1.5em'}}>
                                            {expandedMonths[monthKey] ? '‚ñº' : '‚ñ∂'}
                                        </div>
                                    </div>
                                    
                                    {expandedMonths[monthKey] && (
                                        <div className="collapsible-content">
                                            <div className="transaction-list">
                                                {[...data.transactions].reverse().map((transaction) => (
                                                    <div key={transaction.id} className={`transaction-item ${transaction.type}`}>
                                                        <div className="item-details">
                                                            <h4>{transaction.description}</h4>
                                                            <p>{transaction.category} ‚Ä¢ {new Date(transaction.date).toLocaleDateString()}</p>
                                                        </div>
                                                        <div style={{display: 'flex', alignItems: 'center', gap: '15px'}}>
                                                            <div className={`item-amount ${transaction.type === 'income' ? 'positive' : 'negative'}`}>
                                                                {transaction.type === 'income' ? '+' : '-'}{formatCurrency(Math.abs(parseFloat(transaction.amount) || 0))}
                                                            </div>
                                                            <button 
                                                                className="danger"
                                                                onClick={() => deleteTransaction(transaction.id)}
                                                                style={{padding: '8px 16px', fontSize: '0.9em'}}
                                                            >
                                                                Delete
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );
        }

        // Recurring Tab Component
        function RecurringTab({ recurringPayments, setRecurringPayments, debts, setDebts, transactions, setTransactions }) {
            const [formData, setFormData] = useState({
                name: '',
                amount: '',
                category: '',
                dueDay: '1',
                linkedDebt: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                if (formData.name && formData.amount) {
                    setRecurringPayments([...recurringPayments, {
                        ...formData,
                        amount: parseFloat(formData.amount),
                        dueDay: parseInt(formData.dueDay),
                        id: Date.now()
                    }]);
                    setFormData({
                        name: '',
                        amount: '',
                        category: '',
                        dueDay: '1',
                        linkedDebt: ''
                    });
                }
            };

            const deletePayment = (id) => {
                setRecurringPayments(recurringPayments.filter(p => p.id !== id));
            };

            const processPayment = (payment) => {
                // Add transaction
                const newTransaction = {
                    type: 'expense',
                    amount: payment.amount,
                    description: `${payment.name} (Recurring)`,
                    category: payment.category,
                    date: new Date().toISOString().split('T')[0],
                    id: Date.now()
                };
                setTransactions([...transactions, newTransaction]);

                // Update linked debt balance if applicable
                if (payment.linkedDebt) {
                    setDebts(debts.map(debt => {
                        if (debt.id === parseInt(payment.linkedDebt)) {
                            const newBalance = debt.currentBalance - payment.amount;
                            return {
                                ...debt,
                                currentBalance: Math.max(0, newBalance)
                            };
                        }
                        return debt;
                    }));
                }

                alert(`Payment processed: ${payment.name} for ${formatCurrency(payment.amount)}`);
            };

            return (
                <div>
                    <div className="section">
                        <h2>Add Recurring Payment</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Payment Name</label>
                                    <input 
                                        type="text"
                                        value={formData.name}
                                        onChange={(e) => setFormData({...formData, name: e.target.value})}
                                        placeholder="e.g., Mortgage, Netflix"
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Amount</label>
                                    <input 
                                        type="number" 
                                        step="0.01"
                                        value={formData.amount}
                                        onChange={(e) => setFormData({...formData, amount: e.target.value})}
                                        placeholder="0.00"
                                        required
                                    />
                                </div>
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Category</label>
                                    <input 
                                        type="text"
                                        value={formData.category}
                                        onChange={(e) => setFormData({...formData, category: e.target.value})}
                                        placeholder="e.g., Housing, Entertainment"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Due Day (1-31)</label>
                                    <input 
                                        type="number"
                                        min="1"
                                        max="31"
                                        value={formData.dueDay}
                                        onChange={(e) => setFormData({...formData, dueDay: e.target.value})}
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Link to Debt (Optional)</label>
                                    <select 
                                        value={formData.linkedDebt}
                                        onChange={(e) => setFormData({...formData, linkedDebt: e.target.value})}
                                    >
                                        <option value="">None</option>
                                        {debts.map(debt => (
                                            <option key={debt.id} value={debt.id}>
                                                {debt.name}
                                            </option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                            <button type="submit">Add Recurring Payment</button>
                        </form>
                    </div>

                    <div className="section">
                        <h2>Recurring Payments ({recurringPayments.length})</h2>
                        <div className="payment-list">
                            {recurringPayments.length === 0 ? (
                                <p style={{color: '#6c757d', textAlign: 'center', padding: '20px'}}>
                                    No recurring payments yet.
                                </p>
                            ) : (
                                recurringPayments.map((payment) => {
                                    const linkedDebt = payment.linkedDebt ? debts.find(d => d.id === parseInt(payment.linkedDebt)) : null;
                                    return (
                                        <div key={payment.id} className="payment-item">
                                            <div className="item-details">
                                                <h4>{payment.name}</h4>
                                                <p>
                                                    {payment.category} ‚Ä¢ Due: Day {payment.dueDay}
                                                    {linkedDebt && ` ‚Ä¢ Linked to: ${linkedDebt.name}`}
                                                </p>
                                            </div>
                                            <div style={{display: 'flex', alignItems: 'center', gap: '15px'}}>
                                                <div className="item-amount negative">
                                                    {formatCurrency(payment.amount)}
                                                </div>
                                                <button 
                                                    onClick={() => processPayment(payment)}
                                                    style={{padding: '8px 16px', fontSize: '0.9em'}}
                                                >
                                                    Process
                                                </button>
                                                <button 
                                                    className="danger"
                                                    onClick={() => deletePayment(payment.id)}
                                                    style={{padding: '8px 16px', fontSize: '0.9em'}}
                                                >
                                                    Delete
                                                </button>
                                            </div>
                                        </div>
                                    );
                                })
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Debts Tab Component
        function DebtsTab({ debts, setDebts }) {
            const [formData, setFormData] = useState({
                name: '',
                originalBalance: '',
                currentBalance: '',
                interestRate: '',
                minimumPayment: '',
                category: 'Credit Card'
            });

            const [expandedDebt, setExpandedDebt] = useState(null);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (formData.name && formData.currentBalance) {
                    setDebts([...debts, {
                        ...formData,
                        originalBalance: parseFloat(formData.originalBalance) || parseFloat(formData.currentBalance),
                        currentBalance: parseFloat(formData.currentBalance),
                        interestRate: parseFloat(formData.interestRate) || 0,
                        minimumPayment: parseFloat(formData.minimumPayment) || 0,
                        id: Date.now()
                    }]);
                    setFormData({
                        name: '',
                        originalBalance: '',
                        currentBalance: '',
                        interestRate: '',
                        minimumPayment: '',
                        category: 'Credit Card'
                    });
                }
            };

            const deleteDebt = (id) => {
                setDebts(debts.filter(d => d.id !== id));
            };

            const calculatePayoffMonths = (debt) => {
                if (debt.minimumPayment <= 0 || debt.currentBalance <= 0) return 'N/A';
                
                const monthlyRate = (debt.interestRate / 100) / 12;
                let balance = debt.currentBalance;
                let months = 0;
                
                while (balance > 0 && months < 600) {
                    const interest = balance * monthlyRate;
                    const principal = debt.minimumPayment - interest;
                    
                    if (principal <= 0) return '‚àû (payment < interest)';
                    
                    balance -= principal;
                    months++;
                }
                
                return months;
            };

            const formatPayoffDate = (months) => {
                if (months === 'N/A' || typeof months === 'string') return months;
                
                const today = new Date();
                const payoffDate = new Date(today.getFullYear(), today.getMonth() + months, today.getDate());
                return payoffDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            };

            return (
                <div>
                    <div className="section">
                        <h2>Add New Debt</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Debt Name</label>
                                    <input 
                                        type="text"
                                        value={formData.name}
                                        onChange={(e) => setFormData({...formData, name: e.target.value})}
                                        placeholder="e.g., Visa Card, Car Loan"
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Category</label>
                                    <select 
                                        value={formData.category}
                                        onChange={(e) => setFormData({...formData, category: e.target.value})}
                                    >
                                        <option value="Credit Card">Credit Card</option>
                                        <option value="Auto Loan">Auto Loan</option>
                                        <option value="Mortgage">Mortgage</option>
                                        <option value="Personal Loan">Personal Loan</option>
                                        <option value="Student Loan">Student Loan</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Original Balance</label>
                                    <input 
                                        type="number" 
                                        step="0.01"
                                        value={formData.originalBalance}
                                        onChange={(e) => setFormData({...formData, originalBalance: e.target.value})}
                                        placeholder="0.00"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Current Balance</label>
                                    <input 
                                        type="number" 
                                        step="0.01"
                                        value={formData.currentBalance}
                                        onChange={(e) => setFormData({...formData, currentBalance: e.target.value})}
                                        placeholder="0.00"
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Interest Rate (%)</label>
                                    <input 
                                        type="number" 
                                        step="0.01"
                                        value={formData.interestRate}
                                        onChange={(e) => setFormData({...formData, interestRate: e.target.value})}
                                        placeholder="0.00"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Minimum Payment</label>
                                    <input 
                                        type="number" 
                                        step="0.01"
                                        value={formData.minimumPayment}
                                        onChange={(e) => setFormData({...formData, minimumPayment: e.target.value})}
                                        placeholder="0.00"
                                    />
                                </div>
                            </div>
                            <button type="submit">Add Debt</button>
                        </form>
                    </div>

                    <div className="section">
                        <h2>Active Debts ({debts.length})</h2>
                        <div className="debt-list">
                            {debts.length === 0 ? (
                                <p style={{color: '#6c757d', textAlign: 'center', padding: '20px'}}>
                                    No debts tracked yet.
                                </p>
                            ) : (
                                debts.map((debt) => {
                                    const payoffMonths = calculatePayoffMonths(debt);
                                    const payoffDate = formatPayoffDate(payoffMonths);
                                    const progressPercent = debt.originalBalance > 0 
                                        ? ((debt.originalBalance - debt.currentBalance) / debt.originalBalance * 100)
                                        : 0;
                                    
                                    return (
                                        <div key={debt.id} className="collapsible-section">
                                            <div 
                                                className="collapsible-header"
                                                onClick={() => setExpandedDebt(expandedDebt === debt.id ? null : debt.id)}
                                            >
                                                <div>
                                                    <h3>{debt.name}</h3>
                                                    <p style={{fontSize: '0.9em', marginTop: '5px', opacity: 0.9}}>
                                                        {debt.category} ‚Ä¢ Balance: {formatCurrency(debt.currentBalance)}
                                                    </p>
                                                </div>
                                                <div style={{fontSize: '1.5em'}}>
                                                    {expandedDebt === debt.id ? '‚ñº' : '‚ñ∂'}
                                                </div>
                                            </div>
                                            
                                            {expandedDebt === debt.id && (
                                                <div className="collapsible-content">
                                                    <div className="debt-details">
                                                        <div className="debt-detail-item">
                                                            <label>Original Balance</label>
                                                            <div className="value">{formatCurrency(debt.originalBalance)}</div>
                                                        </div>
                                                        <div className="debt-detail-item">
                                                            <label>Current Balance</label>
                                                            <div className="value">{formatCurrency(debt.currentBalance)}</div>
                                                        </div>
                                                        <div className="debt-detail-item">
                                                            <label>Interest Rate</label>
                                                            <div className="value">{debt.interestRate.toFixed(2)}%</div>
                                                        </div>
                                                        <div className="debt-detail-item">
                                                            <label>Minimum Payment</label>
                                                            <div className="value">{formatCurrency(debt.minimumPayment)}</div>
                                                        </div>
                                                        <div className="debt-detail-item">
                                                            <label>Payoff Timeline</label>
                                                            <div className="value">
                                                                {typeof payoffMonths === 'number' ? `${payoffMonths} months` : payoffMonths}
                                                            </div>
                                                        </div>
                                                        <div className="debt-detail-item">
                                                            <label>Projected Payoff</label>
                                                            <div className="value">{payoffDate}</div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div style={{marginTop: '15px'}}>
                                                        <label style={{display: 'block', marginBottom: '8px', fontSize: '0.9em'}}>
                                                            Progress: {progressPercent.toFixed(1)}% paid off
                                                        </label>
                                                        <div className="progress-bar">
                                                            <div 
                                                                className="progress-fill" 
                                                                style={{width: `${Math.min(progressPercent, 100)}%`}}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div style={{marginTop: '20px', display: 'flex', gap: '10px'}}>
                                                        <button 
                                                            className="danger"
                                                            onClick={() => deleteDebt(debt.id)}
                                                        >
                                                            Delete Debt
                                                        </button>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Payoff Strategies Tab Component
        function PayoffStrategiesTab({ debts }) {
            const [extraPayment, setExtraPayment] = useState(0);
            const [selectedStrategy, setSelectedStrategy] = useState('snowball');

            // Calculate payoff timeline for a single debt
            const calculateDebtPayoff = (debt, monthlyPayment) => {
                if (monthlyPayment <= 0 || debt.currentBalance <= 0) {
                    return { months: 0, totalInterest: 0 };
                }

                const monthlyRate = (parseFloat(debt.interestRate) / 100) / 12;
                let balance = parseFloat(debt.currentBalance);
                let months = 0;
                let totalInterest = 0;

                while (balance > 0 && months < 600) {
                    const interest = balance * monthlyRate;
                    const principal = monthlyPayment - interest;

                    if (principal <= 0) {
                        return { months: 999, totalInterest: 999999 }; // Payment too low
                    }

                    totalInterest += interest;
                    balance -= principal;
                    months++;
                }

                return { months, totalInterest };
            };

            // Snowball Method: Pay off smallest balance first
            const calculateSnowball = () => {
                const sortedDebts = [...debts]
                    .map(d => ({
                        ...d,
                        currentBalance: parseFloat(d.currentBalance),
                        minimumPayment: parseFloat(d.minimumPayment),
                        interestRate: parseFloat(d.interestRate)
                    }))
                    .sort((a, b) => a.currentBalance - b.currentBalance);

                return calculatePayoffOrder(sortedDebts);
            };

            // Avalanche Method: Pay off highest interest rate first
            const calculateAvalanche = () => {
                const sortedDebts = [...debts]
                    .map(d => ({
                        ...d,
                        currentBalance: parseFloat(d.currentBalance),
                        minimumPayment: parseFloat(d.minimumPayment),
                        interestRate: parseFloat(d.interestRate)
                    }))
                    .sort((a, b) => b.interestRate - a.interestRate);

                return calculatePayoffOrder(sortedDebts);
            };

            // Calculate payoff order
            const calculatePayoffOrder = (sortedDebts) => {
                const timeline = [];
                let currentMonth = 0;
                let totalInterest = 0;
                let remainingDebts = sortedDebts.map(d => ({ ...d }));
                const extra = parseFloat(extraPayment) || 0;

                while (remainingDebts.length > 0) {
                    // Pay minimum on all debts
                    let availableExtra = extra;
                    
                    remainingDebts = remainingDebts.filter(debt => {
                        const monthlyRate = (debt.interestRate / 100) / 12;
                        const interest = debt.currentBalance * monthlyRate;
                        totalInterest += interest;

                        let payment = debt.minimumPayment;
                        
                        // Apply extra payment to first debt
                        if (debt === remainingDebts[0]) {
                            payment += availableExtra;
                        }

                        const principal = payment - interest;
                        debt.currentBalance -= principal;

                        if (debt.currentBalance <= 0) {
                            timeline.push({
                                name: debt.name,
                                month: currentMonth,
                                category: debt.category,
                                originalBalance: debt.currentBalance + principal
                            });
                            return false;
                        }
                        return true;
                    });

                    currentMonth++;
                    
                    if (currentMonth > 600) break; // Safety limit
                }

                return { timeline, totalMonths: currentMonth, totalInterest };
            };

            const snowballResult = calculateSnowball();
            const avalancheResult = calculateAvalanche();
            const activeResult = selectedStrategy === 'snowball' ? snowballResult : avalancheResult;

            const formatMonth = (monthNum) => {
                const date = new Date();
                date.setMonth(date.getMonth() + monthNum);
                return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            };

            return (
                <div>
                    <div className="section">
                        <h2>üéØ Debt Payoff Strategies</h2>
                        <p style={{color: '#a0aec0', lineHeight: '1.6', marginBottom: '20px'}}>
                            Compare two popular debt payoff strategies to find the best approach for your situation.
                        </p>

                        <div className="form-row" style={{marginBottom: '20px'}}>
                            <div className="form-group">
                                <label>Extra Monthly Payment</label>
                                <input 
                                    type="number"
                                    step="0.01"
                                    value={extraPayment}
                                    onChange={(e) => setExtraPayment(e.target.value)}
                                    placeholder="0.00"
                                />
                            </div>
                            <div className="form-group">
                                <label>View Strategy</label>
                                <select 
                                    value={selectedStrategy}
                                    onChange={(e) => setSelectedStrategy(e.target.value)}
                                >
                                    <option value="snowball">Debt Snowball</option>
                                    <option value="avalanche">Debt Avalanche</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    {debts.length === 0 ? (
                        <div className="section">
                            <p style={{color: '#a0aec0', textAlign: 'center', padding: '40px'}}>
                                No debts to analyze. Add debts in the Debt Tracking tab to see payoff strategies.
                            </p>
                        </div>
                    ) : (
                        <>
                            <div className="dashboard-grid">
                                {/* Snowball Method */}
                                <div className="section">
                                    <h2>‚ùÑÔ∏è Debt Snowball</h2>
                                    <p style={{color: '#a0aec0', fontSize: '0.9em', marginBottom: '15px'}}>
                                        Pay off smallest balances first for psychological wins
                                    </p>
                                    <div className="chart-container">
                                        <div style={{marginBottom: '20px'}}>
                                            <div style={{fontSize: '2em', fontWeight: '700', color: '#667eea', marginBottom: '5px'}}>
                                                {snowballResult.totalMonths} months
                                            </div>
                                            <div style={{color: '#a0aec0', fontSize: '0.9em'}}>
                                                Total Interest: {formatCurrency(snowballResult.totalInterest)}
                                            </div>
                                            <div style={{color: '#a0aec0', fontSize: '0.9em'}}>
                                                Debt-Free: {formatMonth(snowballResult.totalMonths)}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Avalanche Method */}
                                <div className="section">
                                    <h2>‚õ∞Ô∏è Debt Avalanche</h2>
                                    <p style={{color: '#a0aec0', fontSize: '0.9em', marginBottom: '15px'}}>
                                        Pay off highest interest rates first to save money
                                    </p>
                                    <div className="chart-container">
                                        <div style={{marginBottom: '20px'}}>
                                            <div style={{fontSize: '2em', fontWeight: '700', color: '#667eea', marginBottom: '5px'}}>
                                                {avalancheResult.totalMonths} months
                                            </div>
                                            <div style={{color: '#a0aec0', fontSize: '0.9em'}}>
                                                Total Interest: {formatCurrency(avalancheResult.totalInterest)}
                                            </div>
                                            <div style={{color: '#a0aec0', fontSize: '0.9em'}}>
                                                Debt-Free: {formatMonth(avalancheResult.totalMonths)}
                                            </div>
                                        </div>
                                        {avalancheResult.totalInterest < snowballResult.totalInterest && (
                                            <div style={{
                                                background: '#28a745',
                                                color: 'white',
                                                padding: '10px',
                                                borderRadius: '5px',
                                                fontSize: '0.85em',
                                                textAlign: 'center'
                                            }}>
                                                üí∞ Saves {formatCurrency(snowballResult.totalInterest - avalancheResult.totalInterest)} in interest
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>

                            {/* Payoff Timeline */}
                            <div className="section">
                                <h2>
                                    {selectedStrategy === 'snowball' ? '‚ùÑÔ∏è Snowball' : '‚õ∞Ô∏è Avalanche'} Payoff Timeline
                                </h2>
                                <div style={{marginTop: '20px'}}>
                                    {activeResult.timeline.map((item, index) => (
                                        <div key={index} style={{
                                            background: '#1a1f2e',
                                            padding: '15px 20px',
                                            borderRadius: '8px',
                                            marginBottom: '10px',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center',
                                            borderLeft: '4px solid #28a745'
                                        }}>
                                            <div>
                                                <h4 style={{color: '#e2e8f0', marginBottom: '5px'}}>
                                                    {item.name}
                                                </h4>
                                                <p style={{color: '#a0aec0', fontSize: '0.85em'}}>
                                                    {item.category}
                                                </p>
                                            </div>
                                            <div style={{textAlign: 'right'}}>
                                                <div style={{color: '#28a745', fontWeight: '700', fontSize: '1.1em'}}>
                                                    Month {item.month}
                                                </div>
                                                <div style={{color: '#a0aec0', fontSize: '0.85em'}}>
                                                    {formatMonth(item.month)}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </>
                    )}
                </div>
            );
        }

        // Settings Tab Component
        function SettingsTab({ exportData, importData, clearAllData }) {
            return (
                <div>
                    <div className="section">
                        <h2>Data Management</h2>
                        <div className="controls">
                            <button onClick={exportData}>
                                üíæ Export Data
                            </button>
                            <label style={{
                                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                                color: 'white',
                                padding: '12px 30px',
                                borderRadius: '8px',
                                cursor: 'pointer',
                                fontWeight: 600,
                                display: 'inline-block'
                            }}>
                                üìÅ Import Data
                                <input 
                                    type="file" 
                                    accept=".json"
                                    onChange={importData}
                                    style={{display: 'none'}}
                                />
                            </label>
                            <button className="danger" onClick={clearAllData}>
                                üóëÔ∏è Clear All Data
                            </button>
                        </div>
                        <p style={{marginTop: '20px', color: '#6c757d', fontSize: '0.9em'}}>
                            Export your data to save a backup, import previously exported data, or clear all data to start fresh.
                        </p>
                    </div>

                    <div className="section">
                        <h2>About</h2>
                        <p style={{marginBottom: '15px', lineHeight: '1.6'}}>
                            <strong>Finance Tracker v1.3.0-beta</strong>
                        </p>
                        <p style={{marginBottom: '10px', lineHeight: '1.6', color: '#6c757d'}}>
                            A comprehensive personal finance management tool with enhanced dashboard visualizations,
                            debt management, and recurring payment automation.
                        </p>
                        <h3 style={{marginTop: '20px', marginBottom: '10px', color: '#667eea'}}>Phase 2 Features:</h3>
                        <ul style={{lineHeight: '1.8', color: '#6c757d', marginLeft: '20px'}}>
                            <li>Enhanced dashboard with spending breakdown charts</li>
                            <li>Financial health score based on debt-to-income ratio</li>
                            <li>Debt overview cards with visual progress indicators</li>
                            <li>Upcoming payments calendar for the month</li>
                            <li>Category-based expense analysis</li>
                        </ul>
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<FinanceTracker />, document.getElementById('root'));
    </script>
</body>
</html>
